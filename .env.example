# ===========================================
# ACS Environment Configuration
# ===========================================
# 
# This file contains ALL environment variables for the ACS backend.
# The frontend does NOT use environment variables in production.
# 
# Usage:
#   - Docker/Docker Compose: Copy this file to .env in project root
#   - Standalone Backend: Copy this file to backend/.env
#   - Railway/Cloud Platforms: Set these as environment variables in dashboard
#   - Development: Copy to .env and customize for local setup
#
# Security: NEVER commit .env files with real secrets to version control!
# 
# ===========================================

# ====================
# Server Configuration
# ====================
PORT=3001
NODE_ENV=production

# ====================
# Database Configuration
# ====================
# SQLite (default) - data stored in DATA_DIR
DATA_DIR=/app/data

# PostgreSQL (optional)
# DB_CLIENT=postgres
# POSTGRES_URL=postgresql://username:password@localhost:5432/database_name
# POSTGRES_SSL=true
# POSTGRES_SSL_REJECT_UNAUTHORIZED=true
# POSTGRES_SSL_CA=/path/to/ca-certificate.crt

# ====================
# Base URLs
# ====================
# Base URL for the application (used for password reset emails and other links)
BASE_URL=http://localhost:3000

# Frontend URL for generating links in emails (attestations, password reset, etc.)
# Fallback chain: branding.app_url (database) -> FRONTEND_URL -> BASE_URL -> localhost:3000
FRONTEND_URL=http://localhost:5173

# ====================
# Security Configuration
# ====================

# Allowed Origins for CORS (comma-separated)
# Controls which domains can make API requests
# IMPORTANT: In production, only include your actual frontend domain(s)
# Example: ALLOWED_ORIGINS=https://kars.example.com,https://app.example.com
ALLOWED_ORIGINS=http://localhost:3000,http://localhost:5173

# JWT Authentication Secret
# CRITICAL: This MUST be changed in production!
# Generate with: openssl rand -base64 32
# Changing this will invalidate ALL existing user sessions
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production
JWT_EXPIRES_IN=7d

# Admin Email - Users with this email automatically get admin role
# First registered user always becomes admin regardless of this setting
# ADMIN_EMAIL=admin@yourdomain.com

# ====================
# Encryption Configuration
# ====================
# ACS_MASTER_KEY is required for encrypting sensitive data at rest (SMTP passwords, etc.)
# Generate a 256-bit (32-byte) key with: node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"
# ACS_MASTER_KEY=your-generated-key-here

# ====================
# Proxy & Rate Limiting Configuration
# ====================
# Trust proxy - Enable when behind reverse proxy (Cloudflare, nginx, load balancer)
TRUST_PROXY=true

# Proxy type - Determines which IP header to use for rate limiting
# Options: cloudflare | standard | none
# - cloudflare: Uses CF-Connecting-IP header (for Cloudflare deployments)
# - standard: Uses X-Forwarded-For header (for nginx, ALB, etc.)
# - none: Direct connection, no proxy
PROXY_TYPE=cloudflare

# Proxy trust level - How many proxy hops to trust
# Examples: 1 (single proxy), 2 (load balancer + proxy), true (trust all)
PROXY_TRUST_LEVEL=1

# Rate Limiting - Protect against abuse and DDoS
RATE_LIMIT_ENABLED=true
RATE_LIMIT_WINDOW_MS=900000  # 15 minutes in milliseconds
RATE_LIMIT_MAX_REQUESTS=100  # Maximum requests per window per IP

# ====================
# OIDC/SSO Configuration
# ====================
# Enable OIDC authentication (set to 'true' to enable)
OIDC_ENABLED=false

# OIDC Provider Configuration
# OIDC_ISSUER_URL=https://your-domain.auth0.com
# OIDC_CLIENT_ID=your-client-id
# OIDC_CLIENT_SECRET=your-client-secret
# OIDC_REDIRECT_URI=http://localhost:3000/auth/callback
# OIDC_SCOPE=openid email profile
# OIDC_ROLE_CLAIM_PATH=roles
# OIDC_DEFAULT_ROLE=employee

# ====================
# Attestation Scheduler Configuration
# ====================
# Enable automated attestation reminders and escalations
# When enabled, runs daily checks for:
# - Sending reminder emails to employees with pending attestations
# - Escalating overdue attestations to managers
# - Auto-closing campaigns past their end date
RUN_ATTESTATION_SCHEDULER=true

# ====================
# Passkey/WebAuthn Configuration
# ====================
# Enable passkey authentication system-wide
# PASSKEY_ENABLED=true
# PASSKEY_RP_ID=localhost
# PASSKEY_RP_NAME=ACS - Asset Compliance System
# PASSKEY_ORIGIN=http://localhost:5173
